---
// TODO Add navigation
// TODO prototype data, stub in, see how it works
// TODO mobile / responsive
// todo breathe, slow down, practice good css (does tailwind discourage / limit css learning?)
// TODO dark mode?
// TODO Make table horizontally scrollable?
// TODO What does scope attribute do on tr?
// TODO Standardize link styles
// TODO Standardize utility emojis (alt text)

import Image from "astro/components/Image.astro";
import Layout from "../layouts/layout.astro";
import Logo from "../components/logo.astro";
import EliminatedEmoji from "../assets/images/emoji/skull-and-crossbones.svg";
import SurprisedEmoji from "../assets/images/emoji/hushed-face.svg";
import type { TeamCodeType } from "../data";

interface Team {
  tricode: TeamCodeType;
  w: number;
  l: number;
  ou: number;
  name: string;
  emoji: string;
}

const teams: Team[] = [
  {
    tricode: "BKN",
    name: "Brooklyn Nets",
    w: 11,
    l: 17,
    ou: 19.5,
    emoji: "dragon",
  },
  {
    tricode: "DET",
    name: "Detroit Pistons",
    w: 12,
    l: 17,
    ou: 24.5,
    emoji: "racing-car",
  },
  {
    tricode: "POR",
    name: "Portland Trail Blazers",
    w: 9,
    l: 19,
    ou: 22.5,
    emoji: "person-walking",
  },
  {
    tricode: "CHI",
    name: "Chicago Bulls",
    w: 13,
    l: 16,
    ou: 27.5,
    emoji: "ox",
  },
  {
    tricode: "CHA",
    name: "Charlotte Hornets",
    w: 7,
    l: 21,
    ou: 29.5,
    emoji: "honeybee",
  },
  {
    tricode: "WAS",
    name: "Washington Wizards",
    w: 4,
    l: 22,
    ou: 20.5,
    emoji: "mage",
  },
  {
    tricode: "UTA",
    name: "Utah Jazz",
    w: 7,
    l: 20,
    ou: 29.5,
    emoji: "saxophone",
  }, // 29.5 seems way high for the jazz?
  {
    tricode: "ATL",
    name: "Atlanta Hawks",
    w: 14,
    l: 15,
    ou: 35.5,
    emoji: "feather",
  },
  {
    tricode: "TOR",
    name: "Toronto Raptors",
    w: 7,
    l: 22,
    ou: 30.5,
    emoji: "t-rex",
  },
];

/*
Nets	19.5
Pistons	24.5
Blazers	22.5
Bulls	27.5
Hornets	29.5
Hawks	35.5
Jazz	29.5
Wizards	20.5
Raptors	30.5
*/

interface TeamExtended extends Team {
  toSurprise: number;
  projectedWins: number;
}

const pace = (team: TeamExtended) => {
  return team.projectedWins - team.toSurprise;
};

const teamsExtended: TeamExtended[] = teams
  .map((team) => {
    const toSurprise = Math.ceil(team.ou + 10);
    const currentWinPct = team.w / (team.w + team.l);
    const projectedWins = Math.round(82 * currentWinPct); // TODO floor or round?

    return {
      ...team,
      toSurprise,
      projectedWins,
    };
  })
  .toSorted((a, b) => pace(b) - pace(a));
---

<style>
  #standings {
    border-collapse: collapse;
    box-shadow: 0px 0px 80px 40px rgb(163 230 53 / 0.5); /* shadow-lime-400/50 */
    position: relative;

    > thead th {
      @apply sticky bg-slate-950 p-6 text-right text-4xl text-lime-400;
      top: 0;
      z-index: 1;
    }

    > tbody th,
    > tbody td {
      @apply px-4 py-8 text-4xl text-green-200;
    }

    > tbody > tr {
      &:nth-of-type(2n + 1) {
        @apply bg-lime-950;
      }
    }
  }
</style>

<Layout>
  <main class="p-8 px-0 pb-24 md:px-8">
    <h1 class="text-center font-title text-5xl text-lime-400 md:text-7xl">
      NBA Surprise Teams Tracker
    </h1>
    <nav class="mb-20 mt-16 flex justify-center">
      <a
        class="text-4xl text-indigo-400 underline hover:text-indigo-100"
        href="/info">What is this?</a
      >
    </nav>
    <table id="standings" class="w-[100%] max-w-4xl table-fixed md:mx-auto">
      <thead>
        <tr>
          <th scope="col" class="w-1/2"></th>
          <th scope="col" class="md:w-1/3">
            <span class="md:hidden">O/U</span>
            <span class="hidden md:inline">Over/Under</span>
          </th>
          <th scope="col" class="text-right">Pace</th>
        </tr>
      </thead>
      <tbody>
        {
          teamsExtended.map((team) => {
            return (
              <tr>
                <th scope="row">
                  <div class="flex flex-row items-center gap-4">
                    <Logo code={team.tricode} />
                    <a
                      class="relative text-indigo-400 underline hover:text-indigo-100"
                      href="/2024/bkn"
                    >
                      <span class="hidden md:inline">{team.name}</span>
                      <span class="md:hidden">{team.tricode}</span>
                      <span class="absolute -right-16 -top-3 flex flex-row gap-2">
                        <Image
                          src={SurprisedEmoji}
                          alt="Emoji indicating team is a surprise team"
                          width={20}
                        />
                        <Image
                          src={EliminatedEmoji}
                          alt="Emoji indicating given team is eliminated from surprise team contention"
                          width={20}
                        />
                      </span>
                    </a>
                  </div>
                </th>
                <td class="text-right">{team.ou}</td>
                <td class="text-right">{pace(team)}</td>
              </tr>
            );
          })
        }
      </tbody>
      <tfoot class="bg-slate-950">
        <tr>
          <td colspan="3" class="space-y-2 px-4 py-4">
            <div class="flex flex-row gap-4">
              <Image
                src={SurprisedEmoji}
                alt="Emoji indicating team is a surprise team"
                width={16}
              />
              <span class="text-xl italic text-lime-400">Surprise Team</span>
            </div>
            <div class="flex flex-row gap-4">
              <Image
                src={EliminatedEmoji}
                alt="Emoji indicating given team is eliminated from surprise team contention"
                width={16}
              />
              <span class="text-xl italic text-lime-400">Eliminated</span>
            </div>
          </td>
        </tr>
      </tfoot>
    </table>
  </main>
</Layout>
